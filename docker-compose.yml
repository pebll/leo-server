services:
  uvicorn-service:
    container_name: uvicorn-container
    build:
      context: .
      network: host
      dockerfile: Dockerfile
    volumes:
      - ~/minimalserver:/server
    ports:
      - '8000:8000'
    networks:
      - backend
  reverse-proxy-service:
    container_name: reverse-proxy-container
    image: caddy
    restart: always
    ports:
      - '80:80' # http
      - '443:443' # https
    volumes:
      - caddy-config:/config
      - caddy-data:/data
      - ./Caddyfile:/etc/caddy/Caddyfile
    networks:
      - backend
  radicale:
    image: tomsquest/docker-radicale
    container_name: radicale-service
    restart: unless-stopped
    ports:
      - "127.0.0.1:5232:5232"
    volumes:
      - ./radicale/data:/data
      - ./radicale/config:/config:ro
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - CHOWN
      - SETUID
      - SETGID
      - KILL
    pids_limit: 50
    mem_limit: 256M

volumes:
  caddy-config:
  caddy-data:
networks: 
  backend: {}
